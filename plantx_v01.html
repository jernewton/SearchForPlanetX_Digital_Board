<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Planet X Solo Board</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; }
    svg { margin-top: 20px; }
    .sector { cursor: pointer; }
    .label { fill: white; font-size: 14px; text-anchor: middle; dominant-baseline: middle; }
    .sun-highlight { fill: yellow; opacity: 0.2; pointer-events: none; }
    .theory-label { fill: red; font-size: 12px; text-anchor: middle; dominant-baseline: middle; }
    .controls { margin-top: 20px; }
    select, button { margin: 5px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Planet X Solo Board</h1>
  <div class="controls">
    <button onclick="advanceSun()">Advance Sun</button>
    <select id="sectorSelect"></select>
    <select id="objectSelect">
      <option value="asteroid">Asteroid</option>
      <option value="gas">Gas Cloud</option>
      <option value="comet">Comet</option>
      <option value="dwarf">Dwarf Planet</option>
      <option value="planetx">Planet X</option>
    </select>
    <button onclick="submitTheory()">Submit Theory</button>
    <button onclick="resolveTheory()">Resolve Theory</button>
  </div>

  <svg id="board" width="600" height="600"></svg>

  <script>
    const width = 600;
    const height = 600;
    const radius = 250;
    const sectors = 12;
    const centerX = width / 2;
    const centerY = height / 2;

    let sunPosition = 0; // start at sector 0
    let currentTheory = null;

    const svg = d3.select("#board");
    const arc = d3.arc().innerRadius(100).outerRadius(radius);
    const pie = d3.pie().value(1).sort(null);

    const data = Array.from({ length: sectors }, (_, i) => ({
      id: i,
      type: "unknown"
    }));

    const colorMap = {
      unknown: "#444",
      asteroid: "#a6a6a6",
      gas: "#1f77b4",
      comet: "#ff7f0e",
      dwarf: "#2ca02c",
      planetx: "#d62728"
    };

    const g = svg.append("g").attr("transform", `translate(${centerX}, ${centerY})`);

    const arcGroups = g.selectAll(".sector")
      .data(pie(data))
      .enter()
      .append("g")
      .attr("class", "sector")
      .on("click", (event, d) => {
        if (!isSectorVisible(d.data.id)) return; // prevent changing non-visible sectors
        const order = ["unknown", "asteroid", "gas", "comet", "dwarf", "planetx"];
        const current = d.data.type;
        const next = order[(order.indexOf(current) + 1) % order.length];
        d.data.type = next;
        render();
      });

    arcGroups.append("path").attr("class", "arc");
    arcGroups.append("text").attr("class", "label");
    arcGroups.append("text").attr("class", "theory-label");

    function render() {
      arcGroups.select(".arc")
        .attr("d", arc)
        .attr("fill", d => colorMap[d.data.type])
        .classed("sun-highlight", d => isSectorVisible(d.data.id));

      arcGroups.select(".label")
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .text(d => d.data.id + 1);

      arcGroups.select(".theory-label")
        .attr("transform", d => `translate(${arc.centroid(d)[0]}, ${arc.centroid(d)[1] + 20})`)
        .text(d => currentTheory && d.data.id === currentTheory.sector ? currentTheory.type : "");
    }

    function isSectorVisible(sectorId) {
      const visible = Array.from({ length: 6 }, (_, i) => (sunPosition + i) % sectors);
      return visible.includes(sectorId);
    }

    function advanceSun() {
      sunPosition = (sunPosition + 1) % sectors;
      render();
    }

    function submitTheory() {
      const sector = +document.getElementById("sectorSelect").value;
      const type = document.getElementById("objectSelect").value;
      currentTheory = { sector, type };
      render();
    }

    function resolveTheory() {
      currentTheory = null;
      render();
    }

    // Populate sector selector
    const sectorSelect = document.getElementById("sectorSelect");
    for (let i = 0; i < sectors; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.text = `Sector ${i + 1}`;
      sectorSelect.appendChild(opt);
    }

    render();
  </script>
</body>
</html>
