<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Planet X Solo Board</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      display: flex;
      flex-direction: row;
    }
    #boardContainer {
      width: 33%;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #noteTrackerContainer {
      width: 34%;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f9f9f9;
    }
    #notesPanel {
      width: 33%;
      padding: 10px;
      background-color: #fff;
      border-left: 1px solid #ccc;
      overflow-y: auto;
      height: 100vh;
    }
    svg { margin-top: 20px; }
    .sector { cursor: pointer; }
    .label { fill: white; font-size: 14px; text-anchor: middle; dominant-baseline: middle; }
    .sun-highlight { fill: yellow; opacity: 0.2; pointer-events: none; }
    .theory-label { fill: red; font-size: 12px; text-anchor: middle; dominant-baseline: middle; }
    .controls { margin-top: 20px; }
    select, button { margin: 5px; font-size: 16px; }
    .note-wheel-sector { stroke: #ccc; stroke-width: 1px; }
    .note-symbol { cursor: pointer; }
    .note-x { stroke: red; stroke-width: 2px; pointer-events: none; }
    textarea.note-line {
      width: 100%;
      height: 1.5em;
      margin-bottom: 5px;
      font-size: 14px;
      resize: none;
    }
  </style>
</head>
<body>
  <!-- Left board container -->
  <div id="boardContainer">
    <div>
      <h1>Planet X Solo Board</h1>
      <div class="controls">
        <button onclick="advanceSun()">Advance Sun</button>
        <select id="sectorSelect"></select>
        <select id="objectSelect">
          <option value="asteroid">Asteroid</option>
          <option value="gas">Gas Cloud</option>
          <option value="comet">Comet</option>
          <option value="dwarf">Dwarf Planet</option>
          <option value="planetx">Planet X</option>
        </select>
        <button onclick="submitTheory()">Submit Theory</button>
        <button onclick="resolveTheory()">Resolve Theory</button>
      </div>
      <svg id="board" width="400" height="400"></svg>
    </div>
  </div>

  <!-- Center note tracker -->
  <div id="noteTrackerContainer">
    <svg id="noteWheel" width="400" height="400"></svg>
  </div>

  <!-- Right panel with notes -->
  <div id="notesPanel">
    <h2>Notes</h2>
    <div id="noteLines"></div>
  </div>

  <script>
    // Generate 25 freeform note lines, label last 8 with A-F, X
    const noteLines = document.getElementById("noteLines");
    for (let i = 0; i < 25; i++) {
      const textarea = document.createElement("textarea");
      textarea.className = "note-line";
      if (i < 7) textarea.placeholder = String.fromCharCode(65 + (i));
      noteLines.appendChild(textarea);
      if (i == 7) textarea.placeholder = String.fromCharCode(88);
      noteLines.appendChild(textarea);
    }

    const width = 400; // Width of SVG
    const height = 400; // Height of SVG
    const radius = 160; // Radius for main board sectors
    const sectors = 12; // Number of sectors
    const centerX = width / 2;
    const centerY = height / 2;

    let sunPosition = 0;
    let currentTheory = null;

    const svg = d3.select("#board");
    const arc = d3.arc().innerRadius(80).outerRadius(radius);
    const pie = d3.pie().value(1).sort(null);

    const data = Array.from({ length: sectors }, (_, i) => ({ id: i, type: "unknown" }));

    const colorMap = {
      unknown: "#444",
      asteroid: "#a6a6a6",
      gas: "#1f77b4",
      comet: "#ff7f0e",
      dwarf: "#2ca02c",
      planetx: "#d62728"
    };

    const g = svg.append("g").attr("transform", `translate(${centerX}, ${centerY})`);

    const arcGroups = g.selectAll(".sector")
      .data(pie(data))
      .enter()
      .append("g")
      .attr("class", "sector")
      .on("click", (event, d) => {
        if (!isSectorVisible(d.data.id)) return;
        const order = ["unknown", "asteroid", "gas", "comet", "dwarf", "planetx"];
        const current = d.data.type;
        const next = order[(order.indexOf(current) + 1) % order.length];
        d.data.type = next;
        render();
      });

    arcGroups.append("path").attr("class", "arc");
    arcGroups.append("text").attr("class", "label");
    arcGroups.append("text").attr("class", "theory-label");

    function render() {
      arcGroups.select(".arc")
        .attr("d", arc)
        .attr("fill", d => colorMap[d.data.type])
        .classed("sun-highlight", d => isSectorVisible(d.data.id));

      arcGroups.select(".label")
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .text(d => d.data.id + 1);

      arcGroups.select(".theory-label")
        .attr("transform", d => `translate(${arc.centroid(d)[0]}, ${arc.centroid(d)[1] + 20})`)
        .text(d => currentTheory && d.data.id === currentTheory.sector ? currentTheory.type : "");
    }

    function isSectorVisible(sectorId) {
      const visible = Array.from({ length: 6 }, (_, i) => (sunPosition + i) % sectors);
      return visible.includes(sectorId);
    }

    function advanceSun() {
      sunPosition = (sunPosition + 1) % sectors;
      render();
    }

    function submitTheory() {
      const sector = +document.getElementById("sectorSelect").value;
      const type = document.getElementById("objectSelect").value;
      currentTheory = { sector, type };
      render();
    }

    function resolveTheory() {
      currentTheory = null;
      render();
    }

    const sectorSelect = document.getElementById("sectorSelect");
    for (let i = 0; i < sectors; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.text = `Sector ${i + 1}`;
      sectorSelect.appendChild(opt);
    }

    render();

    // ----- Note Tracker Wheel -----
    const noteSymbols = ["comet", "asteroid", "dwarf", "gas", "empty", "planetx"];
    const symbolRadius = 160;
    const symbolSize = 20;

    const noteSvg = d3.select("#noteWheel");
    const noteG = noteSvg.append("g").attr("transform", "translate(200,200)");
    const noteArc = d3.arc().innerRadius(0).outerRadius(200);
    const notePie = d3.pie().value(1).sort(null);

    const sectorsNote = Array.from({ length: sectors }, (_, i) => ({ id: i }));
    const toggledSymbols = {};

    const noteGroups = noteG.selectAll(".note-sector")
      .data(notePie(sectorsNote))
      .enter()
      .append("g")
      .attr("class", "note-sector");

    noteGroups.append("path")
      .attr("d", noteArc)
      .attr("fill", "#f0f0f0")
      .attr("class", "note-wheel-sector");

    noteGroups.each(function (d, i) {
      const angle = (d.startAngle + d.endAngle) / 2;
      noteSymbols.forEach((symbol, index) => {
        const r = 50 + index * 25;
        const x = Math.cos(angle - Math.PI / 2) * r;
        const y = Math.sin(angle - Math.PI / 2) * r;

        const key = `${i}-${symbol}`;
        toggledSymbols[key] = false;

        const g = d3.select(this).append("g")
          .attr("transform", `translate(${x},${y})`)
          .attr("class", "note-symbol")
          .attr("data-key", key)
          .style("cursor", "pointer")
          .on("click", function () {
            toggledSymbols[key] = !toggledSymbols[key];
            renderToggles();
          });

        g.append("image")
          .attr("href", `${symbol}.png`)
          .attr("width", symbolSize)
          .attr("height", symbolSize)
          .attr("x", -symbolSize / 2)
          .attr("y", -symbolSize / 2);

        g.append("line")
          .attr("class", "note-x")
          .attr("x1", -symbolSize / 2)
          .attr("y1", -symbolSize / 2)
          .attr("x2", symbolSize / 2)
          .attr("y2", symbolSize / 2)
          .style("display", "none");

        g.append("line")
          .attr("class", "note-x")
          .attr("x1", -symbolSize / 2)
          .attr("y1", symbolSize / 2)
          .attr("x2", symbolSize / 2)
          .attr("y2", -symbolSize / 2)
          .style("display", "none");
      });
    });

    function renderToggles() {
      noteG.selectAll(".note-symbol").each(function () {
        const g = d3.select(this);
        const key = g.attr("data-key");
        const active = toggledSymbols[key];
        g.selectAll(".note-x").style("display", active ? "block" : "none");
      });
    }
  </script>
</body>
</html>